# 表单对象

简介：本文为表单对象笔记，完整笔记详见[Github](https://github.com/MrEnvision/Front-end_learning_notes)

作者：[Envision](https://github.com/MrEnvision)         联系邮箱：[EnvisionShen@gmail.com](mailto:EnvisionShen@gmail.com)



## 概念

```html
<form action="/handling-page" method="post">
  <div>
    <label for="name">用户名：</label>
    <input type="text" id="name" name="user_name" required/>
  </div>
  <div>
    <label for="passwd">密码：</label>
    <input type="password" id="passwd" name="user_passwd" />
  </div>
  <div>
    <input type="submit" id="submit" name="submit_button" value="提交" />
  </div>
</form>
```

表单提交以键值对的形式，键名是控件的`name`属性，键值是控件的`value`属性。

- 表单以GET形式提交，所有键值对会以 URL 的查询字符串形式，提交到服务器——`/handling-page?user_name=张三&user_passwd=123&submit_button=提交`
- 表单以POST形式提交，所有键值对会连接成一行，作为 HTTP 请求的数据体发送到服务器——`user_name=张三&user_passwd=123&submit_button=提交`

> 注意，实际提交的时候，只要键值不是 URL 的合法字符（比如汉字“张三”和“提交”），浏览器会自动对其进行编码。编码解码参见[URL 对象](浏览器部分对象1.md)



## FormData对象

> `FormData()`构造函数的参数是一个表单元素，如果参数为空，则默认为空表单。

```javascript
var formdata = new FormData(form);
```

表单实例方法—开头表单为例：

```javascript
var myForm = document.getElementById('myForm');
var formData = new FormData(myForm);

// 获取指定键名对应的键值，参数为键名
formData.get('user_name');
// 返回一个数组，表示指定键名对应的所有键值
formData.getAll();
// 设置指定键名的键值
formData.set('user_name','Envision');
// 删除一个键值对
formData.delete('user_name');
// 添加一个键值对。注意，如果键名重复，则会生成两个相同键名的键值对！！！
formData.append('user_name','Shen');
// 返回一个布尔值，表示是否具有该键名的键值对
formData.has('user_name');
// 返回一个遍历器对象，用于for...of循环遍历。
formData.keys(); formData.values();formData.enties();
```



## 表单校验

自动校验

```javascript
<!-- 必填 -->
<input required>

<!-- 必须符合正则表达式 -->
<input pattern="banana|cherry">

<!-- 字符串长度必须为6个字符 -->
<input minlength="6" maxlength="6">

<!-- 数值必须在1到10之间 -->
<input type="number" min="1" max="10">

<!-- 必须填入 Email 地址 -->
<input type="email">

<!-- 必须填入 URL -->
<input type="URL">
```

> 如果一个控件通过验证，它就会匹配`:valid`的 CSS 伪类，浏览器会继续进行表单提交的流程。如果没有通过验证，该控件就会匹配`:invalid`的 CSS 伪类，浏览器会终止表单提交，并显示一个错误信息。

手动校验

```javascript
// 触发整个表单的校验
form.checkValidity()
// 触发单个表单控件的校验
formControl.checkValidity()
```



## 控件元素属性

- 控件元素的`willValidate`属性是一个布尔值，表示该控件是否会在提交时进行校验。
- 控件元素的`validationMessage`属性返回一个字符串，表示控件不满足校验条件时，浏览器显示的提示文本。控件不会在提交时自动校验或控件满足校验条件则返回空字符串。
- 控件元素的`setCustomValidity()`方法用来定制校验失败时的报错信息。
- 控件元素的属性`validity`属性返回一个`ValidityState`对象，包含当前校验状态的信息。

```javascript
var input = document.querySelector('#name');
input.willValidate // true
input.validationMessage // "请填写此字段。"
input.setCustomValidity('您必须填写姓名');
```



## 表单属性

- `novalidate`属性为布尔值，可以关闭浏览器的自动校验。
- `enctype`属性决定表单的编码格式 —— `GET`方法发送数据，`enctype`属性无效；`POST`方法发送数据，`enctype`属性有效，默认以`application/x-www-form-urlencoded`格式发送，其他还有`text/plain`纯文本格式和`multipart/form-data`混合格式。当上传文件的时候`form`的`enctype`属性就需要改为`multipart/form-data`混合格式



结合[File对象](浏览器部分对象2.md)以下说明一个上传图片文件的例子。

```html
<form method="post" enctype="multipart/form-data">
  <div>
    <label for="file">选择图片文件</label>
    <input type="file" id="file" name="myFile" multiple>
  </div>
  <div>
    <input type="submit" id="submit" name="submit_button" value="上传" />
  </div>
</form>
```

>multiple属性可以指定可以一次选择多个文件；如果没有这个属性，则一次只能选择一个文件。

```javascript
var fileSelect = document.getElementById('file');
var files = fileSelect.files;
// 新建一个 FormData 实例对象，模拟发送到服务器的表单数据
var formData = new FormData();
for (var i = 0; i < files.length; i++) {
  var file = files[i];
  // 只上传图片文件
  if (!file.type.match('image.*')) {
    continue;
  }
  formData.append('photos[]', file, file.name);
}
// 使用 Ajax 向服务器上传文件
var xhr = new XMLHttpRequest();
xhr.open('POST', 'handler.php', true);
xhr.onload = function () {
  if (xhr.status !== 200) {
    console.log('An error occurred!');
  }
};
xhr.send(formData);
```

> 当然也可以不使用FormData 实例对象，直接 AJAX 发送文件

```javascript
var fileSelect = document.getElementById('file');
var file = fileSelect.files[0];
var xhr = new XMLHttpRequest();
xhr.open('POST', 'myserver/uploads');
xhr.setRequestHeader('Content-Type', file.type);
xhr.send(file);
```



------

如果发现本项目有错误，欢迎提交 issues 指正。